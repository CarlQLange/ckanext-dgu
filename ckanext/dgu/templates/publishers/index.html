<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <xi:include href="publisher_util.html" />

  <py:def function="page_title">Publisher</py:def>
  <py:def function="page_heading">Publishers</py:def>

  <py:match path="primarysidebar">
    <li class="widget-container boxed widget_text">
      <h3>Publishers</h3>
      <span i18n:msg="">Description of publishers</span>
    </li>
  </py:match>

  <div py:match="content">
	<div id="tabs">
		<ul>
			<li><a href="#publisherlist">Publisher list</a></li>
			<li><a href="#publisherhierarchy">Publisher hierarchy</a></li>
			<li><a href="#publishersearch">Publisher search</a></li>
		</ul>
		<div id="publisherlist">
		    ${c.page.pager()}
		    ${publisher_list(c.page.items)}
		    ${c.page.pager()}
		</div>
		<div id="publisherhierarchy">
			<div id="publisher_tree" class="" style="background-color: white;">
				${publisher_tree( c.all_groups )}
			</div>
		</div>
		<div id="publishersearch" style="text-align:center;">
	        <input type="search" class="search autocomplete-publisherx" id="q" value="${c.q}" style="width:400px;" autocomplete="off" results="0" placeholder="${_('Search...')}"  />
			<button onclick="return  publisher_search();">${_('Search...')}</button>
			<table id="search_results" class="groups" style="display:none;">
			</table>
		</div>
	</div>

	<div>&nbsp;</div>
  </div>

  <py:def function="optional_head">
	<!--[if IE 7]>
		<style>
			.ui-icon { text-indent: 0; }
			.node { padding: 2px; }
		</style>
	<![endif]-->

	<script type="text/javascript">
		function publisher_search() {
			var term = $("#q").val();
			$("#search_results").empty();
			$("#search_results").css("display", "block");
			var url = CKAN.SITE_URL + '/api/2/util/group/autocomplete?type=publisher&amp;q=' + term;
        	$.getJSON(url, function(data) {
				$("#search_results").append( '<tr><th>Title</th></tr>' );
          		$.each(data, function(idx, groupobj) {
					var tpl = '<tr><td>' +
							  	'<a href="/publisher/' + groupobj.name + '">' + groupobj.title + '</a>' +
							  '</td></tr>';
					$("#search_results").append( tpl );
          		});
        	});
			return false;
		}
		$(document).ready(function() {
			$( "#tabs" ).tabs();
			$("#publisher_tree").jstree(
				 {"plugins" : ["themes","html_data","ui"]}
			).delegate('a', 'click', function(e){ window.location.href=$(this).attr('href'); });
		});
	</script>
  </py:def>

  <xi:include href="../layout.html" />
</html>

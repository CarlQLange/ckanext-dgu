<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <py:def function="page_title">${c.report_title} - Report</py:def>
  <py:match path="breadcrumbs">
    <li><a href="${h.url_for('reports')}">Reports</a></li>
    <li><a href="${request.url}">${c.report_title}</a></li>
  </py:match>

  <div py:match="content" py:strip="">
      <h1>${c.report_title}</h1>
      <p>
          Generated: ${h.render_datetime(c.report_date, '%d/%m/%Y %H:%M')}
      </p>
      <div py:if="h.is_sysadmin()" class="panel panel-info" style="width=700px">
          <div class="panel-heading"><strong>Refresh report</strong></div>
          <div class="panel-body">
            <form action="" method="POST">
              <input type="submit" value="Refresh" class="btn btn-info pull-right" style="margin-left: 15px"/>
            </form>
            <p>As a system administrator you are able to refresh this report on demand by clicking the 'Refresh' button. This may take a few moments to complete. Occasionally it will take longer than 30s, in which case you'll see receive error 503. If this occurs, please wait a few minutes before reloading the page to see the refreshed report.</p>
          </div>
      </div>

      <h3>Options</h3>
      <form action="">
          <div py:for="(key, value) in c.options.items()">
            <py:if test="key in c.options_html">${c.options_html[key]}</py:if>
            <py:if test="key not in c.options_html">
              ${key}: ${value}
              <input type="hidden" name="${key}" value="${value}"/>
            </py:if>
          </div>
      </form>

      <h3>Results</h3>
      <py:if test="not c.are_some_results">
        <p>No results found.</p>
      </py:if>

      <py:if test="c.are_some_results">
        <div class="pull-right">
            Download:
            <a class="btn btn-primary" href="${h.relative_url_for(format='csv')}">CSV</a>
            <a class="btn btn-primary" href="${h.relative_url_for(format='json')}">JSON</a>
        </div>
        <div>
          ${c.report_snippet}
        </div>
      </py:if>
  </div>

  <py:def function="optional_footer">
    <script type="text/javascript" src="/scripts/vendor/jquery.tablesorter.min.js"></script>
    <script type="text/javascript">
      //<![CDATA[
      $(document).ready(function()
        {
          $("#report-table").tablesorter({
              dateFormat: "uk",
          });
          $(".js-auto-submit").change(function () {
              $(this).closest("form").submit();
          });
        }
      );
    // ]]>
    </script>
  </py:def>

  <xi:include href="../layout_base.html" />

</html>



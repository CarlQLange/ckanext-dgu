<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <xi:include href="inventory_util.html" />
  <xi:include href="../publisher/publisher_util.html" />

  <py:def function="page_title">${c.group.display_name}</py:def>
  <py:def function="page_heading">
  <py:if test="h.check_access('group_update', {'id':c.group.id})">
    <a href="${h.url_for(controller='ckanext.dgu.controllers.inventory:InventoryController', action='edit',id=c.group.name)}" class="btn btn-info edit">Manage inventory</a>
    <a class="btn btn-info edit" href="${h.url_for('publisher_edit', id=c.group.name)}">Edit</a>
  </py:if>
    <a class="feed-icon" href="${h.url(controller='ckanext.dgu.controllers.publisher:PublisherController', action='read', id=c.group['name'])}">${c.group.display_name}</a>
    <span class="abbreviation" py:if="c.group_extras.get('abbreviation')">&nbsp;(${c.group_extras.get('abbreviation')})</span>
    <a class="feed-icon" href="${h.url(controller='feed', action='group', id=c.group['name'])}" title="${g.site_title} - Datasets in group '${c.group['title']}'">
      <img src="/images/rss.png" width="16" height="16"/>
    </a>
  </py:def>


  <py:match path="primarysidebar">
    ${publisher_sidebar()}
  </py:match>


  <py:match path="content">
    <h3 py:if="c.group['state'] != 'active'">State: ${c.group['state']}</h3>
    <div class="boxed">
      <div class="notes" py:if="str(c.description_formatted).strip()">
        ${c.description_formatted}
      </div>

      <h2>Take part in the data.gov.uk inventory<br/>Manage and Update us on forthcoming datasets</h2>

      <div class="notes">
        <p>Use this inventory tool to download an inventory of all the datasets and inventory items you have published on data.gov.uk to date. This tool allows you to give us prior knowledge of pending datasets including those with a partially open or ‘closed’ licence.</p>
        <ul>
          <li>You can download your latest ‘read only ‘ dataset list anytime</li>
          <li>You can complete the blank inventory template and upload at any time if you have frequent updates</li>
          <li>Download templates are in a CSV file that will be readable in Microsoft Excel, or Open Office, and then also upload a modified file to update your inventory.</li>
        </ul>
      </div>

      <hr/>

      <h3>Step 1: Download the read-only dataset list to review your existing open data</h3>

      <div class="row notes">
        <div class="notes">
          <p>
          Download and review your list of datasets and inventory items recently published or submitted to data.gov.uk. This is only for review and not for uploading new datasets.
          </p>
          <p><strong>Important</strong>: Please review this list before submitting any new inventory items.
          </p>
        </div>
        <div class="row notes">
            <div class="notes span5">
              <em>Tick the sub-department box if you need a complete list of datasets held by other parties under your authority, whom with you may wish to delegate the review of ‘data held’ to.</em>
            </div>

            <form action="${h.url_for(controller='ckanext.dgu.controllers.inventory:InventoryController', action='download', id=c.group.name)}" method="GET" enctype="multipart/form-data" class="form-inline pull-right">
              <input type="submit" class="btn btn-primary" value="Download dataset list"/><br/><br/>
              <label for="include_sub">
                <input type="checkbox" name="include_sub" value="true"/> Include sub-departments
              </label>
            </form>
        </div>
      </div>

      <div class="clearfix"></div>
      <hr/>

      <h3>Step 2: Download the blank inventory template </h3>
      <div class="row notes">
        <div class="notes">
          <p>Complete the blank template based on your initial review of the read-only dataset list.<br/>
          <a href="http://data.gov.uk/inventory-help-guide">See specific guidance</a> on completing this template.</p>
        </div>
        <a href="/inventory/template/xls_template.php?publisher=${c.group.title}" class="btn btn-primary pull-right">Download blank inventory template</a>
      </div>

      <div class="clearfix"></div>
      <hr/>


      <h3>Step 3: Upload the completed inventory template</h3>
      <div class="row notes">
        <div class="notes">
          <p>Upload the completed template, taking care that you have not changed the structure of the template e.g. don't change the styling or location of columns.</p>
          <p><strong>Important</strong>: This template will be verified on upload.</p>
        </div>

        <form action="${h.url_for(controller='ckanext.dgu.controllers.inventory:InventoryController', action='upload', id=c.group.name)}" method="POST" enctype="multipart/form-data" class="form-inline pull-right" style="" >
          <input type="file" name="upload"/>
          <input type="submit" class="btn btn-primary" value="Upload"/>
        </form>

      </div>

      <div class="clearfix"></div>
    </div>
  </py:match>

  <py:def function="optional_feed">
  <link rel="alternate" type="application/atom+xml" title="${g.site_title} - Datasets in group '${c.group['title']}'"
    href="${h.url(controller='feed', action='group', id=c.group['name'])}" />
  </py:def>

  <py:def function="optional_footer">
    <link rel="stylesheet" href="/scripts/vendor/jstree/themes/default/style.css" type="text/css" media="screen" />
    <script src="/scripts/vendor/jstree/jquery.jstree.js"></script>
    <script>
      // Pollute the global namespace
      PUBLISHER_PARENT = "node_${c.parent_publisher.name if c.parent_publisher else ''}";
      PUBLISHER_GROUP  = "node_${c.group.name}";
    </script>
    <script src="/scripts/dgu-publisher.js"></script>
  </py:def>

  <xi:include href="../layout.html" />
</html>



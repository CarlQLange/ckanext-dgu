<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <xi:include href="../facets.html" />
  <py:def function="page_title">Search | data.gov.uk</py:def>
  <py:def function="optional_head">
    <script src="/scripts/dgu-basket.js">
    </script>
  </py:def>

 <py:def function="body_class">no-sidebar no-minornavigation</py:def>

  <div py:match="content">
    <div class="row">
      <div class="span12">
        <xi:include href="search_form.html" />
        <div class="clearfix"></div>
      </div>
    </div>
    <div class="row">
      <div class="span3">
        <div class="facet-box" id="shopping-basket-container">
          <h4><img src="/images/arrow.png" class="arrow"/> Map Preview</h4>
          <ul id="shopping-basket">
          </ul>
          <a href="/data/map-preview?" id="shopping-basket-submit" class="btn btn-datagov">Preview All</a>
        </div>
        <div id="filter-heading">
          <p>You can refine your search results using the filters below</p>
        </div>

        ${facet_filters()}
      </div>
      <div class="offset1 span8">
        <py:if test="c.query_error">
          <p i18n:msg="item_count"><strong>There was an error while searching.</strong> 
              Please try again.</p>
        </py:if>
        <py:if test="request.params">      
        </py:if>
        <py:if test="c.page.item_count == 0 and request.params">
          <p i18n:msg="">Would you like to <a href="${h.url_for(action='new', id=None)}">create a new dataset?</a></p>
        </py:if>
        <div class="boxed sort-by-controls">
          <h4><img src="/images/arrow.png" class="arrow" /> Sort by</h4>
          <label class="radio inline">
            <input type="radio" name="dataset-results-sort" value="${c.sort_by([])}" py:attrs="{'checked': 'checked'} if not c.sort_by_fields else {}"/>
            relevancy
          </label>
          <py:for each="field,title,order in [('titleString','title','asc'), ('metadata_modified','last updated','desc')]">
            <label class="radio inline">
              <input type="radio" name="dataset-results-sort" value="${c.sort_by([(field,order)])}" py:attrs="{'checked': 'checked'} if field in c.sort_by_fields else {}"/>
              ${title}
            </label>
          </py:for>

          <a class="feed-icon" href="${h.url(controller='feed', action='custom')}?${c.search_url_params}">
            <img src="/images/rss.png" alt="Syndicate content" title="Search results" width="16" height="16"/>
          </a>
        </div>

        ${package_list_from_dict(c.page.items)}
        <py:with vars="pager = c.page.pager(q=c.q)">
        <div py:if="pager" class="boxed pager">
          ${pager}
        </div>
        </py:with>
      </div>
    </div>

  </div>

  <py:def function="optional_feed">
  <link rel="alternate" type="application/atom+xml" title="${g.site_title} - Datasets found with custom search: '${c.search_url_params}'"
    href="${h.url(controller='feed', action='custom')}?${c.search_url_params}" />
  </py:def>

  <xi:include href="layout.html" />
</html>



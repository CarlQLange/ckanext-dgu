<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  py:strip=""
  >
  <xi:include href="../_util.html" />

  <div class="boxed boxed-flush-top">
    <!-- Overview Section -->
    <div id="dataset-overview">

      <!-- Description -->
      <div class="notes" py:if="str(c.pkg_notes_formatted).strip()">
        <h3>Description</h3>
        ${c.pkg_notes_formatted}
      </div>

      <!-- Resources -->
      <div id="dataset-resources" class="resources subsection">
        <py:if test="c.pkg_dict.get('individual_resources') or not c.pkg_dict.get('timeseries_resources')">
          <h3>Data Files (${str(len(c.pkg_dict.get('individual_resources',[])))})</h3>
          <ul class="resource-list">
            <py:for each="res in c.pkg_dict.get('individual_resources', [])">
            <li>
              <a href="${h.url_for(controller='package', action='resource_read', id=c.pkg_dict['name'], resource_id=res['id'])}">
                ${h.icon('page_white')}
                ${h.resource_display_name(res)}
                <span py:if="res.get('format')" class="format-box" property="dc:format">${res.get('format')}</span>
              </a>
              <div class="resource-buttons">
                <a href="${h.url_for(controller='package', action='resource_read', id=c.pkg_dict['name'], resource_id=res['id'])}" class="href-action btn btn-small btn-black-text">Details</a>
                <a href="${res.get('url', '')}" class="href-action btn btn-small btn-datagov">Download</a>
              </div>
              </li>
            </py:for>
          </ul>
        </py:if>
        <py:if test="c.pkg_dict.get('timeseries_resources')">
          <h3>Data Files (${str(len(c.pkg_dict.get('timeseries_resources',[])))} in a time series)</h3>
          <ul class="resource-list">
            <py:for each="res in c.pkg_dict.get('timeseries_resources', [])">
            <li>
              <a href="${h.url_for(controller='package', action='resource_read', id=c.pkg_dict['name'], resource_id=res['id'])}">
                ${h.icon('page_white')}
                ${res.get('date')}
                ${h.resource_display_name(res)}
                <span py:if="res.get('format')" class="format-box" property="dc:format">${res.get('format')}</span>
              </a>
              <div class="resource-buttons">
                <a href="${h.url_for(controller='package', action='resource_read', id=c.pkg_dict['name'], resource_id=res['id'])}" class="href-action btn btn-small btn-black-text">Details</a>
                <a href="${res.get('url', '')}" class="href-action btn btn-small btn-datagov">Download</a>
              </div>
              </li>
            </py:for>
          </ul>
        </py:if>
        <?python
            is_uklp = False
            uklp = [v[1] for i,v in enumerate(c.pkg_extras) if v[0] == 'UKLP']
            if uklp and uklp[0] == 'True':
                is_uklp = True
                harvest_object_id = [v[1] for i,v in enumerate(c.pkg_extras) if v[0] == 'harvest_object_id']
                if harvest_object_id:
                    harvest_object_id = harvest_object_id[0]
        ?>
        <div py:if="is_uklp" id="dataset-gemini-links">
            <div>
                <a href="/api/2/rest/harvestobject/${harvest_object_id}/xml" target="_blank">Source GEMINI2 document</a> (XML)
            </div>
            <div>
                <a href="/api/2/rest/harvestobject/${harvest_object_id}/html" target="_blank">Formatted GEMINI2 document</a> (HTML)
            </div>
        </div>
        <py:if test="c.pkg_dict.get('additional_resources')"> 
          <h3>Additional Links ${str(len(c.pkg_dict.get('additional_resources',[])))})</h3>
          <ul class="resource-list">
            <py:for each="res in c.pkg_dict.get('additional_resources', [])">
            <li>
              <a href="${h.url_for(controller='package', action='resource_read', id=c.pkg_dict['name'], resource_id=res['id'])}">
                ${h.icon('page_white')}
                ${res.get('date')}
                ${h.resource_display_name(res)}
                <span py:if="res.get('format')" class="format-box" property="dc:format">${res.get('format')}</span>
              </a>
              <div class="resource-buttons">
                <a href="${h.url_for(controller='package', action='resource_read', id=c.pkg_dict['name'], resource_id=res['id'])}" class="href-action btn btn-small btn-black-text">Details</a>
                <a href="${res.get('url', '')}" class="href-action btn btn-small btn-datagov">Download</a>
              </div>
              </li>
            </py:for>
          </ul>
        </py:if>

        <py:if test="not (is_uklp or c.pkg_dict.get('individual_resources') or c.pkg_dict.get('timeseries_resources') or c.pkg_dict.get('additional_resources'))">
          <em>(none)</em>
        </py:if>
      </div>

    </div>

    <!-- Dataset Information Section -->
    <h3>Additional Information</h3>
    <div id="dataset-information">
    <table class="table table-bordered table-striped table-condensed">
      <tbody>
        <tr py:if="c.pkg.url">
          <td class="dataset-label">Source</td>
          <td class="dataset-details" property="foaf:homepage">${c.pkg_url_link}</td>
        </tr>

        <tr py:if="c.pkg_author_link">
          <td class="dataset-label">Author</td>
          <td class="dataset-details" property="dc:creator">${c.pkg_author_link}</td>
        </tr>

        <tr py:if="c.pkg_maintainer_link">
          <td class="dataset-label">Maintainer</td>
          <td class="dataset-details" property="dc:contributor">${c.pkg_maintainer_link}</td>
        </tr>

        <tr py:if="c.pkg.version">
          <td class="dataset-label">Version</td>
          <td class="dataset-details">${c.pkg.version}</td>
        </tr>

        <tr py:if="c.eu_country">
          <td class="dataset-label">Country</td>
          <td class="dataset-details">${h.code_to_country(c.eu_country)}</td>
        </tr>

        <tr py:if="h.check_access('package_update',{'id':c.pkg.id})">
          <td class="dataset-label">State</td>
          <td class="dataset-details">${c.pkg.state}</td>
        </tr>

        <tr py:if="c.harvest_catalogue_name">
          <td class="dataset-label">Harvest Source</td>
          <td class="dataset-details">
            <a href="${c.harvest_dataset_url}">Dataset page</a> on 
            <a href="${c.harvest_catalogue_url}">${c.harvest_catalogue_name}</a>
          </td>
        </tr>

        <tr py:for="i, (key, value) in enumerate(c.pkg_extras)"
          rel="dc:relation" resource="_:extra${i}">
          <td class="dataset-label" property="rdfs:label">${_(key)}</td>
          <td class="dataset-details" property="rdf:value">${value}</td>
        </tr>
      </tbody>
    </table>

    </div>

    <div id="api-information">
        <h3>Developer Tools</h3>
        <div>
            <p>
                This information on this page (the package metadata) is also
                available programatically via this site's <a
                  href="${h.url_for(controller='ckanext.dgu.controllers.data:DataController', action='api')}">CKAN API</a>.
            </p>
            <dl>
              <dt>JSON</dt>
              <dd>
                <code>
                  <py:if test="config.get('ckan.api_url')">
                    <a href="${config.get('ckan.api_url') + h.url_for(controller='api', register='package', action='show', id=c.pkg.name, ver='2')}">
                      ${config.get('ckan.api_url') + h.url_for(controller='api', register='package', action='show', id=c.pkg.name, ver='2')}</a>
                  </py:if>                
                  <py:if test="not config.get('ckan.api_url')">
                    <a href="${h.url_for(controller='api', register='package', action='show', id=c.pkg.name, ver='2')}">
                      ${h.url_for(controller='api', register='package', action='show', id=c.pkg.name, ver='2')}</a>
    
                  </py:if>
                </code>
              </dd>
              <dt>URI</dt>
              <dd>
                <code>
                  <a href="${h.url_for(controller='package', action='read', id=c.pkg.name)}">
                      ${h.url_for(controller='package', action='read', id=c.pkg.name)}
                  </a>
                </code>
              </dd>
            </dl>
        </div>
    </div>

  </div> <!-- /dataset -->

</html>

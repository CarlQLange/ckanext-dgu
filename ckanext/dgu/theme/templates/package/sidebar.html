<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >


<py:match path="primarysidebar">
  <li py:if="c.pkg.license_id" id="dataset-license" class="widget-container">
    <h3>Licence</h3>
    <ul>
    <li property="dc:rights">
      <py:choose test="">
        <py:when test="c.pkg.license and c.pkg.license.url">
          <a href="${c.pkg.license.url}" rel="dc:rights">"${c.pkg.license.title.split('::')[-1]}"</a>
        </py:when>
        <py:when test="c.pkg.license">
          "${c.pkg.license.title}" 
        </py:when>
        <py:otherwise>
          "${c.pkg.license_id}" 
        </py:otherwise>
      </py:choose>
      <span class="closed" py:if="not c.pkg.isopen()">${h.icon('lock')}</span>
    </li>

    <py:if test="c.pkg.isopen()">
    <li>
      <a href="http://opendefinition.org/okd/" title="This dataset satisfies the Open Definition.">
          <img class="open-data" src="http://assets.okfn.org/images/ok_buttons/od_80x15_blue.png" alt="[Open Data]" />
      </a>
    </li>
    </py:if>
    </ul>
  </li>

  <li class="widget-container">
    <h3>Feedback</h3>
    <ul><li><a href="${h.url_for(controller='package', action='read', id=c.pkg_dict.get('name'))}/feedback">Give feedback to department</a></li></ul>
  </li>

  <?python
    from ckan import model
  ?>
  <li py:if="h.check_access('package_delete', {'id':c.pkg.id}) and c.pkg.state != model.State.DELETED" class="widget-container">
    <h3>Deletion</h3>
    <ul><li><a href="${h.url_for(controller='ckanext.dgu.controllers.package_gov3:PackageGov3Controller', action='delete', id=c.pkg.name)}">Delete this dataset</a></li></ul>
  </li>

  <li py:if="c.pkg_dict.get('tags')" class="widget-container">
    <h3>Tags</h3>
    ${tag_list(c.pkg_dict.get('tags', ''))}
  </li>

  <li id="social_media" class="widget-container">
    <h3>Social</h3>
    <p>Tell the world about this dataset!</p>
    <?python
      import urllib
      import urlparse
      def external_link(domain, path, params):
        encoded_params = dict((k,unicode.encode(unicode(v), 'utf-8')) for k,v in params.items())
        return urlparse.urlunparse(('http', domain, path, '', urllib.urlencode(encoded_params), ''))
    ?>
    <a href="${external_link('twitter.com', '/home/', {'status': g.site_url + h.url_for(controller='package', action='read', id=c.pkg_dict.get('name')) + ' -- ' + c.pkg_dict.get('title','')})}" rel="nofollow" title="Share this on Twitter" id="service-links-twitter" class="service-links-twitter">
      <img src="/images/service_links/twitter.png" alt="Twitter" width="20" height="20"/>
    </a>

    <a href="${external_link('www.facebook.com', '/sharer.php', {'u': g.site_url + h.url_for(controller='package', action='read', id=c.pkg_dict.get('name')), 't': c.pkg_dict.get('title', '')})}" rel="nofollow" title="Share on Facebook" id="service-links-facebook" class="service-links-facebook">
      <img src="/images/service_links/facebook.png" alt="Facebook" width="20" height="20"/>
    </a>

    <a href="${external_link('www.google.com', '/buzz/post', {'url': g.site_url + h.url_for(controller='package', action='read', id=c.pkg_dict.get('name'))})}" rel="nofollow" title="Buzz this post on Google." id="service-links-google-buzz" class="service-links-google-buzz">
      <img src="/images/service_links/google_buzz.png" alt="Google Buzz" width="23" height="20"/>
    </a>


    <a href="${external_link('www.linkedin.com', '/shareArticle', {'mini': 'true', 'url': g.site_url + h.url_for(controller='package', action='read', id=c.pkg_dict.get('name')), 'title': c.pkg_dict.get('title', ''), 'summary': '', 'source': 'data.gov.uk'})}" rel="nofollow" title="Publish this post to LinkedIn" id="service-links-linkedin" class="service-links-linkedin">
      <img src="/images/service_links/linkedin.png" alt="LinkedIn" width="20" height="20"/>
    </a>
  </li>

  <li class="widget-container">
    <h3>Do more with this data</h3>
    <ul>
      <li><a href="${g.site_url}/node/add/apps?dataset=${c.pkg_dict.get('name')}">Share your app</a><br/></li>
      <li><a href="${g.site_url}/node/add/ideas?dataset=${c.pkg_dict.get('name')}">Share an idea</a><br/></li>
      <li><a href="${g.site_url}/data/requests?dataset=${c.pkg_dict.get('name')}">Request new data</a></li>
    </ul>
  </li>

  <li py:if="c.pkg.get_groups('publisher')" class="widget-container">
    <h3>Publisher</h3>
    <ul class="groups">
      <li py:for="group in sorted(c.pkg.get_groups(), key=lambda g: g.display_name)">
          <a href="${h.url_for(controller='ckanext.dgu.controllers.publisher:PublisherController', action='read', id=group.name)}">${group.display_name}</a>
      </li>
    </ul>
  </li>


</py:match>
</html>

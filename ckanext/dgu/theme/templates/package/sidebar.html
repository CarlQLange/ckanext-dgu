<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >


<py:match path="primarysidebar">

  ${basket()}

  <div py:if="h.get_license_url(c.pkg) or h.get_licenses(c.pkg)" id="dataset-license" class="widget-container">
    <h4>Licence</h4>
    <div property="dc:rights">
     <ul>
      <py:choose test="">
        <py:when test="c.pkg.extras.get('licence_url')">
          <li py:for="license, isopen in h.get_licenses(c.pkg)">
            <a href="${h.get_license_url(c.pkg)}" rel="dc:rights">${license}</a>
            <py:if test="isopen">
              <a href="http://opendefinition.org/okd/" title="This dataset satisfies the Open Definition.">
                <img class="open-data" src="/images/open_data.png" alt="[Open Data]" />
              </a>
            </py:if>
            <py:if test="isopen == False">
              <span class="closed">${h.icon('lock')}</span>
            </py:if>
          </li>
        </py:when>
        <py:when test="h.get_licenses(c.pkg)">
          <li py:for="license, isopen in h.get_licenses(c.pkg)">
            ${license}
            <py:if test="isopen">
              <a href="http://opendefinition.org/okd/" title="This dataset satisfies the Open Definition.">
                <img class="open-data" src="/images/open_data.png" alt="[Open Data]" />
              </a>
            </py:if>
            <py:if test="isopen == False">
              <span class="closed" py:if="not c.pkg.isopen()">${h.icon('lock')}</span>
            </py:if>
          </li>
        </py:when>
        <py:when test="c.pkg.license_id">
          <li>${c.pkg.license_id}</li>
        </py:when>
        <py:otherwise>
          <li>No licence specified</li>
        </py:otherwise>
      </py:choose>
     </ul>
    </div>
  </div>

  <li class="widget-container">
    <h4>Contact</h4>
    Enquiries:
    <ul>
        ${h.get_contact_name(c.pkg, dict(c.pkg_extras))}
        ${contact_details(*h.get_contact_details(c.pkg, dict(c.pkg_extras)))}
    </ul>
    <py:if test="h.have_foi_contact_details(c.pkg, dict(c.pkg_extras))">
      FOI Contact:
      <ul>
          ${h.get_foi_contact_name(c.pkg, dict(c.pkg_extras))}
          ${contact_details(*h.get_foi_contact_details(c.pkg, dict(c.pkg_extras)))}
      </ul>
    </py:if>

  </li>

  <li py:if="h.check_access('package_delete', {'id':c.pkg.id}) and h.is_package_deleted(c.pkg)" class="widget-container">
    <py:if test="h.dataset_type(c.pkg_extras) != 'uklp'">
      <h4>Deletion</h4>
      <a class="btn" href="${h.url_for(controller='ckanext.dgu.controllers.package:PackageController', action='delete', id=c.pkg.name)}">Delete this dataset</a>
    </py:if>
    <py:if test="h.dataset_type(c.pkg_extras) == 'uklp'">
      <h4>Withdrawal</h4>
      <a class="btn" href="${h.url_for(controller='ckanext.dgu.controllers.package:PackageController', action='delete', id=c.pkg.name)}">Withdraw this dataset</a>
    </py:if>
  </li>

  <li py:if="c.pkg_dict['tags']" class="widget-container">
    <h4>Tags</h4>
    ${tag_list_from_dicts(c.pkg_dict['tags'])}
  </li>

  <li py:if="h.dataset_type(c.pkg_extras) == 'uklp' and dict(c.pkg_extras).get('resource-type') in ('dataset', 'series', 'service')" class="widget-container">
    <h4>Coupled ${'Datasets' if dict(c.pkg_extras).get('resource-type') == 'service' else 'Services'}</h4>
    <ul py:if="h.coupled_pkg_tuples(c.pkg)">
      <li py:for="name, title in h.coupled_pkg_tuples(c.pkg)">
        <a href="/dataset/${name}">${title}</a>
      </li>
    </ul>
    <span py:if="not h.coupled_pkg_tuples(c.pkg)">(none)</span>
  </li>

  <li id="social_media" class="widget-container">
    <h4>Social</h4>
    <p>Tell the world about this dataset!</p>
    <!--! Uses ckanext-social extension -->
    ${h.social_sharethis()}
  </li>

  <li class="widget-container">
    <h4>Developer tools</h4>
    <a href="/dataset/${c.pkg_dict.get('name')}#developer-tools">JSON, API and URI</a> for this dataset record
  </li>

  <li class="widget-container">
    <h4>Do more with this data</h4>
    <ul>
      <li><a href="/node/add/apps?dataset=${c.pkg_dict.get('name')}">Share your app</a><br/></li>
      <li><a href="/node/add/ideas?dataset=${c.pkg_dict.get('name')}">Share an idea</a><br/></li>
      <li><a href="/node/add/data-request?dataset=${c.pkg_dict.get('name')}">Request new data</a></li>
    </ul>
  </li>

  <li py:if="c.pkg.get_groups('publisher')" class="widget-container">
    <h4>Publisher</h4>
    <ul class="groups">
      <li py:for="group in sorted(c.pkg.get_groups(), key=lambda g: g.display_name)">
          <a href="${h.url_for(controller='ckanext.dgu.controllers.publisher:PublisherController', action='read', id=group.name)}">${group.display_name}</a>
      </li>
      <li py:if="dict(c.pkg_extras).get('provider')">
        Provider: ${dict(c.pkg_extras).get('provider')}
      </li>
      <li py:if="h.dataset_type(c.pkg_extras) == 'uklp' and dict(c.pkg_extras).get('responsible-party')">
        Responsible Party: ${dict(c.pkg_extras).get('responsible-party')}

      </li>
    </ul>
  </li>


</py:match>
</html>

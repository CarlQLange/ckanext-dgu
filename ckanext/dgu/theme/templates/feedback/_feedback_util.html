<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >

  <div py:def="feedback_item(item, package)" class="wrapper dataset dataset-summary boxed" id="${item.id}">
     <div py:with="title=package.get('title') or package.get('name')">
      <div class="dataset-header">
        <a  href="${h.url_for(controller='package', action='read', id=package.get('name'))}">
         <img class="dataset-icon" src="/images/inventory-feedback.png" title="${h.name_for_uklp_type(package)}"/>
        </a>

        <span class="pull-right" py:if="item.is_publisher">
          Publisher
        </span>

         <h3><span class="underlined"><a  href="${h.url_for(controller='package', action='read', id=package.get('name'))}">${title}</a></span></h3>

       </div>

       <div>
          <span>
            <strong>Submitted by</strong>: ${h.linked_username(item.user_id)} on ${h.render_datetime(item.created, date_format="%d/%m/%Y", with_hours=False)}
          </span>

          <span class="pull-right" py:if="item.organisation_name">
            <strong>Organisation</strong>: ${item.organisation_name}
          </span>
       </div>
       <div>
          <span>
            <strong>Response type</strong>:
            <py:if test="item.responding_as=='individual'">Private individual</py:if>
            <py:if test="item.responding_as=='organisation'">Organisation</py:if>
          </span>
        </div>

        <br/>

        <div class="feedback_item">
            <h3  style="border-bottom: solid 1px #999; margin-bottom: 20px;">Summary</h3>

            <p py:if="item.economic">Economic Growth
                <py:if test="item.economic_comment">: ${h.truncate(item.economic_comment, length=60, whole_word=False)}</py:if>
            </p>
            <p py:if="item.social">Social Growth
                <py:if test="item.social_comment">: ${h.truncate(item.social_comment, length=60, whole_word=False)}</py:if>
            </p>
            <p py:if="item.effective">Effective Public Services
                <py:if test="item.effective_comment">: ${h.truncate(item.effective_comment, length=60, whole_word=False)}</py:if>
            </p>
            <p py:if="item.other">Other Benefits
                <py:if test="item.other_comment">: ${h.truncate(item.other_comment, length=60, whole_word=False)}</py:if>
            </p>
            <p py:if="item.linked">Potential links to other datasets
                <py:if test="item.linked_comment">: ${h.truncate(item.linked_comment, length=60, whole_word=False)}</py:if>
            </p>
        </div>
        <div class="feedback_full" style="display:none;">
            <h3 style="border-bottom: solid 1px #999; margin-bottom: 20px;">Full response</h3>

            <h5 py:if="item.economic">Economic Growth</h5>
            <div py:if="item.economic and item.economic_comment">
              ${item.economic_comment}
              <hr/>
            </div>

            <h5 py:if="item.social">Social Growth</h5>
            <div py:if="item.social and item.social_comment">
              ${item.social_comment}
              <hr/>
            </div>

            <h5 py:if="item.effective">Effective Public Services</h5>
            <div py:if="item.effective and item.effective_comment">
              ${item.effective_comment}
              <hr/>
            </div>

            <h5 py:if="item.other">Other Benefits</h5>
            <div py:if="item.other and item.other_comment">
              ${item.other_comment}
              <hr/>
            </div>

            <h4 py:if="item.linked">Potential links to other datasets</h4>
            <div py:if="item.linked and item.linked_comment">
              ${item.linked_comment}
              <hr/>
            </div>

        </div>
        <a class="pull-right btn btn-primary" href="${h.url_for(controller='ckanext.dgu.controllers.feedback:FeedbackController', action='report_abuse', id=item.id)}">Flag as offensive</a>
        <a  href="javascript:0" onclick="toggle_full_response(this); return false">View full response</a>
       <div class="clearfix"></div>

       ${feedback_moderation_button(item, show_publish=False)}

     </div>
  </div>

<!--! Moderation elements. Prettiness optional. -->
<div py:def="feedback_item_moderation
(item, package)" class="wrapper dataset dataset-summary boxed" id="${item.id}">
     <div py:with="title=package.title or package.name">
            <div class="alert alert-error" py:if="item.visible">
            This feedback is currently visible - it was flagged as offensive
            </div>
            <div class="alert alert-success" py:if="not item.visible">
            This feedback is not currently visible.
            </div>

      <div class="dataset-header">

        <a  href="${h.url_for(controller='package', action='read', id=package.name)}">
         <img class="dataset-icon" src="/images/inventory-feedback.png"/>
        </a>

         <h3><span class="underlined"><a  href="${h.url_for(controller='package', action='read', id=package.name)}">${title}</a></span></h3>

       </div>

       <div>
          <span>
            <strong>Submitted by</strong>: ${h.linked_user(item.user_id, maxlength=40)} on ${h.render_datetime(item.created, date_format="%d/%m/%Y", with_hours=False)}
          </span>

          <span class="pull-right" py:if="item.organisation_name">
            <strong>Organisation</strong>: ${item.organisation_name}
          </span>
       </div>
       <div>
          <span>
            <strong>Response type</strong>:
            <py:if test="item.responding_as=='individual'">Private individual</py:if>
            <py:if test="item.responding_as=='organisation'">Organisation</py:if>
          </span>
        </div>

        <br/>

        <div>
            <h3 style="border-bottom: solid 1px #999; margin-bottom: 20px;">Full response</h3>

            <h5 py:if="item.economic">Economic Growth</h5>
            <div py:if="item.economic and item.economic_comment">
              ${item.economic_comment}
              <hr/>
            </div>

            <h5 py:if="item.social">Social Growth</h5>
            <div py:if="item.social and item.social_comment">
              ${item.social_comment}
              <hr/>
            </div>

            <h5 py:if="item.effective">Effective Public Services</h5>
            <div py:if="item.effective and item.effective_comment">
              ${item.effective_comment}
              <hr/>
            </div>

            <h5 py:if="item.other">Other Benefits</h5>
            <div py:if="item.other and item.other_comment">
              ${item.other_comment}
              <hr/>
            </div>

            <h4 py:if="item.linked">Potential links to other datasets</h4>
            <div py:if="item.linked and item.linked_comment">
              ${item.linked_comment}
              <hr/>
            </div>

            ${feedback_moderation_button(item)}
        </div>
       <div class="clearfix"></div>
     </div>
  </div>


<div py:def="feedback_moderation_button(item, show_publish=True)">

    <div class="form-actions" py:if="h.is_sysadmin()">
    <table width="100%">
    <tr>
      <td py:if="show_publish">
          <a  class="btn btn-primary" href="javascript:0" onclick="return feedback_publish('${item.id}');">Publish</a>
      </td>
      <td py:if="not show_publish">
        <h4 py:if="not show_publish" style="border-bottom: solid 2px #ddd;" class="pull-left">Administrator only</h4>
      </td>
      <td align="right" >

          <a class="btn btn-danger pull-right"  href="javascript:0" onclick="return feedback_delete('${item.id}',false);">
            Delete
          </a>

      </td>
      <td py:if="show_publish">
          <a class="btn btn-danger pull-right"  href="javascript:0" onclick="return feedback_delete('${item.id}',true);">
            Delete and ban
          </a>
      </td>
    </tr>
    </table>

    </div>
</div>

</html>

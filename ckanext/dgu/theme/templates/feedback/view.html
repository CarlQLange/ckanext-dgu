<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">


<xi:include href="_feedback_util.html" />

  <py:def function="page_title">${c.pkg.title or c.pkg.name} - View feedback - Datasets</py:def>

  <py:def function="optional_head">
  <!--!
    <script type="text/javascript">
      var form_errors = ${c.errors_json};
    </script>
    -->
  </py:def>

  <py:def function="page_heading">
      <span py:with="group = sorted(c.pkg.get_groups(), key=lambda g: g.display_name)[0]">
    <a href="${h.url_for(controller='ckanext.dgu.controllers.publisher:PublisherController', action='read', id=group.name)}">${group.display_name}</a> / ${h.dataset_link(c.pkg)}
    </span>
    <span class="subheading"><img src="/images/arrow-down-right.png"/> View Feedback</span>
  </py:def>

<div py:match="primarysidebar" class="dataset">
  <div class="boxed">

    <div class="widget-container">
      <h4>Links</h4>

      <ul>
        <li>
          <a href="${h.url_for(controller='package', action='search')}?unpublished=true" class="">Unpublished datasets</a>
        </li>
        <li>
          <a href="${h.url_for(controller='ckanext.dgu.controllers.publisher:PublisherController', action='read', id=c.publisher.name)}" class="">${c.publisher.title}</a>
        </li>
      </ul>
    </div>
    <div class="widget-container">

      <div class="pull-right">
          <a href="${h.url_for(controller='ckanext.dgu.controllers.feedback:FeedbackController',action='add',id=c.pkg.name)}" py:if="c.user" class="btn btn-primary">Add feedback</a>
          <a href="${h.url_for(controller='ckanext.dgu.controllers.feedback:FeedbackController',action='add',id=c.pkg.name)}" py:if="not c.user" class="btn">Login and add feedback</a>
      </div>


      <div class="clearfix"></div>
    </div>
  </div>
</div>

  <div py:match="content" class="dataset">
    <div class="boxed">
      <div py:if="str(c.pkg_notes_formatted).strip()">
        <h3>Description</h3>
        <!-- blank style tag avoids a bug in jquery.dotdotdot -->
        <div class="" style="">
          ${h.truncate(c.pkg.notes, length=120, whole_word=True)}
        </div>
      </div>
    </div>

    <div>


        <div class="boxed" py:if="c.items.count() == 0">
            <h3>No feedback yet</h3>
        </div>

        <py:for each="item in c.items">
          ${feedback_summary(item, c.pkg_dict)}
        </py:for>

    </div>
  </div>

  <script type="text/javascript">
    function toggle_full_response(obj){
      $(obj).siblings("div.feedback_summary").toggle(function(){
        $(this).siblings("div.feedback_full").toggle('slide')
        if ($(obj).text() == "View full response")
          $(obj).text("View summary")
        else
          $(obj).text("View full response")
      })

    }
  </script>

  <xi:include href="../layout_base.html" />
</html>

